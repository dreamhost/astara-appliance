#!/bin/bash

DIB_ASTARA_APPLIANCE_DEBUG_USER=${DIB_ASTARA_APPLIANCE_DEBUG_USER:-astara-debug}
DIB_ASTARA_APPLIANCE_DEBUG_PASSWORD=${DIB_ASTARA_APPLIANCE_DEBUG_PASSWORD:-astara}

set -eu
set -o xtrace

useradd -m $DIB_ASTARA_APPLIANCE_DEBUG_USER -s /bin/bash

passwd $DIB_ASTARA_APPLIANCE_DEBUG_USER <<EOF
$DIB_ASTARA_APPLIANCE_DEBUG_PASSWORD
$DIB_ASTARA_APPLIANCE_DEBUG_PASSWORD
EOF

cat > /etc/sudoers.d/astara-debug-user <<eof
$DIB_ASTARA_APPLIANCE_DEBUG_USER ALL=(ALL) NOPASSWD:ALL
eof

chmod 0440 /etc/sudoers.d/astara-debug-user
visudo -c
